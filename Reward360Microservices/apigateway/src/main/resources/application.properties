# ===============================
# SERVER & EUREKA CONFIG
# ===============================
server.port=8086
spring.application.name=API-GATEWAY
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

# JWT secret used by gateway to validate incoming tokens (use env var JWT_SECRET in production)
jwt.secret=${JWT_SECRET:Zm9yLWRldmVsb3BtZW50LXNvbHZlLXlvdXItc2VjcmV0LWNoYW5nZQ==}

# application.properties
eureka.instance.prefer-ip-address=true
# ===============================
# GATEWAY ROUTES
# ===============================

# 1. USER SERVICE (Auth & Management)
# Handles /auth/login, /auth/register, /auth/Users
spring.cloud.gateway.routes[0].id=user-service
spring.cloud.gateway.routes[0].uri=http://localhost:8087
spring.cloud.gateway.routes[0].predicates[0]=Path=/auth/**

# 1b. USER API (frontend client expects /user/**)
spring.cloud.gateway.routes[5].id=user-service-user
spring.cloud.gateway.routes[5].uri=http://localhost:8087
spring.cloud.gateway.routes[5].predicates[0]=Path=/user/**

# 2. CUSTOMER SERVICE
# Routes requests starting with /api/users/ to CustomerMs
spring.cloud.gateway.routes[1].id=CustomerMs
spring.cloud.gateway.routes[1].uri=http://localhost:8081
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/users/**

# 3. PROMOTION SERVICE
spring.cloud.gateway.routes[2].id=Promotionservice
spring.cloud.gateway.routes[2].uri=http://localhost:8083
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/promotions/**

# 4. FRAUD DETECTION SERVICE
spring.cloud.gateway.routes[3].id=fraud-detection-service
spring.cloud.gateway.routes[3].uri=http://localhost:8082
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/v1/transactions/**

# 5. ANALYTICS SERVICE
spring.cloud.gateway.routes[4].id=AnalyticsService
spring.cloud.gateway.routes[4].uri=http://localhost:8089
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/analytics/**

# ===============================
# SWAGGER ROUTES (api-docs for each microservice)
# ===============================
# User Service Swagger
spring.cloud.gateway.routes[6].id=user-service-api-docs
spring.cloud.gateway.routes[6].uri=http://localhost:8087
spring.cloud.gateway.routes[6].predicates[0]=Path=/user-service/v3/api-docs/**
spring.cloud.gateway.routes[6].filters[0]=RewritePath=/user-service/(?<remaining>.*), /${remaining}

# Customer Service Swagger
spring.cloud.gateway.routes[7].id=customer-service-api-docs
spring.cloud.gateway.routes[7].uri=http://localhost:8081
spring.cloud.gateway.routes[7].predicates[0]=Path=/customer-service/v3/api-docs/**
spring.cloud.gateway.routes[7].filters[0]=RewritePath=/customer-service/(?<remaining>.*), /${remaining}

# Promotion Service Swagger
spring.cloud.gateway.routes[8].id=promotion-service-api-docs
spring.cloud.gateway.routes[8].uri=http://localhost:8083
spring.cloud.gateway.routes[8].predicates[0]=Path=/promotion-service/v3/api-docs/**
spring.cloud.gateway.routes[8].filters[0]=RewritePath=/promotion-service/(?<remaining>.*), /${remaining}

# Fraud Service Swagger
spring.cloud.gateway.routes[9].id=fraud-service-api-docs
spring.cloud.gateway.routes[9].uri=http://localhost:8082
spring.cloud.gateway.routes[9].predicates[0]=Path=/fraud-service/v3/api-docs/**
spring.cloud.gateway.routes[9].filters[0]=RewritePath=/fraud-service/(?<remaining>.*), /${remaining}

# Analytics Service Swagger
spring.cloud.gateway.routes[10].id=analytics-service-api-docs
spring.cloud.gateway.routes[10].uri=http://localhost:8089
spring.cloud.gateway.routes[10].predicates[0]=Path=/analytics-service/v3/api-docs/**
spring.cloud.gateway.routes[10].filters[0]=RewritePath=/analytics-service/(?<remaining>.*), /${remaining}

# ===============================
# SPRINGDOC - Aggregated Swagger UI on Gateway
# ===============================
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.urls[0].name=User Service
springdoc.swagger-ui.urls[0].url=/user-service/v3/api-docs
springdoc.swagger-ui.urls[1].name=Customer Service
springdoc.swagger-ui.urls[1].url=/customer-service/v3/api-docs
springdoc.swagger-ui.urls[2].name=Promotion Service
springdoc.swagger-ui.urls[2].url=/promotion-service/v3/api-docs
springdoc.swagger-ui.urls[3].name=Fraud Detection Service
springdoc.swagger-ui.urls[3].url=/fraud-service/v3/api-docs
springdoc.swagger-ui.urls[4].name=Analytics Service
springdoc.swagger-ui.urls[4].url=/analytics-service/v3/api-docs

# ===============================
# GLOBAL CORS CONFIGURATION
# ===============================
# Supporting your React apps on ports 5173 and 5174
# ===============================
# FIXED GLOBAL CORS CONFIGURATION
# ===============================
# Use allowedOriginPatterns instead of allowedOrigins to support credentials safely
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOriginPatterns=http://localhost:5173,http://localhost:5174
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowCredentials=true