# ===============================
# SERVER & EUREKA CONFIG
# ===============================
server.port=8086
spring.application.name=API-GATEWAY
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/

# JWT secret used by gateway to validate incoming tokens (use env var JWT_SECRET in production)
jwt.secret=${JWT_SECRET:Zm9yLWRldmVsb3BtZW50LXNvbHZlLXlvdXItc2VjcmV0LWNoYW5nZQ==}

# application.properties
eureka.instance.prefer-ip-address=true
# ===============================
# GATEWAY ROUTES
# ===============================

# 1. USER SERVICE (Auth & Management)
# Handles /auth/login, /auth/register, /auth/Users
spring.cloud.gateway.routes[0].id=user-service
spring.cloud.gateway.routes[0].uri=http://localhost:8087
spring.cloud.gateway.routes[0].predicates[0]=Path=/auth/**

# 1b. USER API (frontend client expects /user/**)
spring.cloud.gateway.routes[5].id=user-service-user
spring.cloud.gateway.routes[5].uri=http://localhost:8087
spring.cloud.gateway.routes[5].predicates[0]=Path=/user/**

# 2. CUSTOMER SERVICE
# Routes requests starting with /api/users/ to CustomerMs
spring.cloud.gateway.routes[1].id=CustomerMs
spring.cloud.gateway.routes[1].uri=http://localhost:8081
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/users/**

# 3. PROMOTION SERVICE
spring.cloud.gateway.routes[2].id=Promotionservice
spring.cloud.gateway.routes[2].uri=http://localhost:8083
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/promotions/**

# 4. FRAUD DETECTION SERVICE
spring.cloud.gateway.routes[3].id=fraud-detection-service
spring.cloud.gateway.routes[3].uri=http://localhost:8082
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/v1/transactions/**

# 5. ANALYTICS SERVICE
spring.cloud.gateway.routes[4].id=AnalyticsService
spring.cloud.gateway.routes[4].uri=http://localhost:8089
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/analytics/**

# ===============================
# GLOBAL CORS CONFIGURATION
# ===============================
# Supporting your React apps on ports 5173 and 5174
# ===============================
# FIXED GLOBAL CORS CONFIGURATION
# ===============================
# Use allowedOriginPatterns instead of allowedOrigins to support credentials safely
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOriginPatterns=http://localhost:5173,http://localhost:5174
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowCredentials=true